{
  "version": "0.1",
  "catalogue": "meetbouten",
  "entity": "referentiepunten",
  "entity_id": "identificatie",
  "source": {
    "name": "Grondslag",
    "entity_id": "identificatie",
    "type": "database",
    "schema": "grondslag",
    "query": [
"    SELECT h.nummer                                                       AS identificatie",
"    ,      substr( h.omschrijving, 1, instr(h.omschrijving, chr(10)) -1 ) AS adres",
"    ,      substr( h.omschrijving, instr(h.omschrijving, chr(10)) + 1 )   AS locatie",
"    ,      h.sta_id                                                       AS status_id-- 1=actueel 2=niet te meten 3=vervallen",
"    ,      s.omschrijving                                                 AS status_omschrijving",
"    ,      to_char(h.vervaldatum, 'YYYY-MM-DD')                           AS vervaldatum",
"    ,      h.mer_id                                                       AS merk_id -- 0, 1, 2, 7, 10, 14, 15, 16, 17, 20, 99",
"    ,      m.omschrijving                                                 AS merk_omschrijving",
"    ,      h.xmuur                                                        AS xmuurvlak",
"    ,      h.ymuur                                                        AS ymuurvlak",
"    ,      h.windr                                                        AS windrichting",
"    ,      k.bou_nummer                                                   AS bouwblok_code",
"    ,      x.hoogte                                                       AS hoogte_tov_nap",
"    ,      to_char(x2.inwindatum, 'YYYY-MM-DD')                           AS datum",
"    ,      CASE",
"             WHEN h.typ_nummer=6 THEN h.nummer",
"             ELSE NULL",
"             END                                                          AS peilmerknummer",
"    ,      to_char(sdo_util.to_wktgeometry(h.geom))                       AS geometrie",
"    ,      'J'                                                            AS publiceerbaar",
"    FROM   grs_hoogtepunten h",
"    LEFT OUTER JOIN   grondslag.grs_kringpunten  k ON h.id = k.hoo_id",
"    LEFT OUTER JOIN   grondslag.grs_status       s ON h.sta_id = s.id",
"    LEFT OUTER JOIN   grondslag.grs_merken       m ON h.mer_id = m.id",
"    LEFT OUTER JOIN   (SELECT m1.hoo_id",
"                       ,      m1.hoogte",
"                       ,      m1.inwindatum",
"                       FROM   grondslag.grs_metingen_herz m1",
"                       JOIN (SELECT m2.hoo_id",
"                             ,      MAX(m2.inwindatum) AS inwindatum",
"                             FROM   grondslag.grs_metingen_herz m2",
"                             GROUP BY m2.hoo_id) q ON  m1.hoo_id = q.hoo_id",
"                                                  AND m1.inwindatum = q.inwindatum) x ON h.id = x.hoo_id",
"    LEFT OUTER JOIN   (SELECT m3.hoo_id",
"                       ,      m3.hoogte",
"                       ,      m3.inwindatum",
"                       FROM   grondslag.grs_metingen_herz m3",
"                       JOIN (SELECT m4.hoo_id",
"                             ,      MIN(m4.inwindatum) AS inwindatum",
"                             FROM   grondslag.grs_metingen_herz m4",
"                             GROUP BY m4.hoo_id) q2 ON  m3.hoo_id = q2.hoo_id",
"                                                  AND m3.inwindatum = q2.inwindatum) x2 ON h.id = x2.hoo_id",
"    WHERE  (h.nummer IN (SELECT h1.nummer",
"                            FROM   grondslag.grs_hoogtepunten h1",
"                            JOIN   grondslag.grs_met_ref_punten_herz r ON h1.id = r.hoo_id",
"                            WHERE  h1.typ_nummer = 6) --nap peilmerk",
"    OR ",
"            h.nummer IN (SELECT h1.nummer",
"                            FROM   grondslag.grs_hoogtepunten h1",
"                            JOIN   grondslag.grs_met_ref_punten_herz r ON h1.id = r.hoo_id",
"                            WHERE  h1.typ_nummer = 9) -- ondergrondsmerk",
"    OR     h.typ_nummer = 8) -- referentiebout"
    ]
  },
  "gob_mapping": {
    "identificatie": {
      "source_mapping": "identificatie"
    },
    "nabij_nummeraanduiding": {
      "source_mapping": {
        "bronwaarde": "adres"
      }
    },
    "locatie": {
      "source_mapping": "locatie"
    },
    "hoogte_tov_nap": {
      "source_mapping": "hoogte_tov_nap"
    },
    "datum": {
      "source_mapping": "datum"
    },
    "status": {
      "source_mapping": {
        "id": "status_id",
        "omschrijving": "status_omschrijving"
      }
    },
    "vervaldatum": {
      "source_mapping": "vervaldatum",
      "format": "%Y-%m-%d"
    },
    "merk": {
      "source_mapping": {
        "id": "merk_id",
        "omschrijving": "merk_omschrijving"
      }
    },
    "x_coordinaat_muurvlak": {
      "source_mapping": "xmuurvlak"
    },
    "y_coordinaat_muurvlak": {
      "source_mapping": "ymuurvlak"
    },
    "windrichting": {
      "source_mapping": "windrichting"
    },
    "ligt_in_bouwblok": {
      "source_mapping": {
        "bronwaarde": "bouwblok_code"
      }
    },
    "is_nap_peilmerk": {
      "source_mapping": {
        "bronwaarde": "peilmerknummer",
        "id": "peilmerknummer"
      }
    },
    "geometrie": {
      "source_mapping": "geometrie"
    },
    "publiceerbaar": {
      "source_mapping": "publiceerbaar",
      "format": "JN"
    }
  }
}
