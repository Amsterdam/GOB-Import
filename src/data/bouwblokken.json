{
  "version": "0.1",
  "catalogue": "gebieden",
  "entity": "bouwblokken",
  "source": {
    "name": "AMSBI",
    "application": "DGDialog",
    "entity_id": "source_id",
    "type": "database",
    "schema": "dgdialog",
    "depends_on": {
      "_application": "DIVA"
    },
    "inject": {
      "from": "data/bouwblokken.conversion.json",
      "on": "code",
      "conversions": {
        "identificatie": "=",
        "volgnummer": "+"
      }
    },
    "enrich": {
      "identificatie": {
        "type": "autoid",
        "on": "code",
        "template": "0363099XXXXXXX"
      }
    },
    "query": [
"    SELECT s.code                               AS code",
"    ,      NULL                                 AS identificatie",
"    ,      q1.volgnummer                        AS volgnummer",
"    ,      to_char(s.datum, 'YYYY-MM-DD')       AS datum_begin_geldigheid",
"    ,      to_char(t.verval, 'YYYY-MM-DD')      AS datum_einde_geldigheid",
"    ,      t.inwin                              AS registratiedatum",
"    ,      t.guid                               AS source_id",
"    ,      sdo_util.to_wktgeometry(t.geometrie) AS geometrie",
"    ,      NULL                                 AS ligt_in_buurt",
"      FROM   gebieden.dgdtw_topografie t",
"      JOIN   gebieden.dgdtw_table_6023 s ON t.id = s.dgdtw_primary_key",
"      JOIN  (SELECT t1.id",
"    ,      t1.guid",
"    ,      dense_rank() OVER (partition BY s1.code ORDER BY t1.inwin) AS volgnummer",
"      FROM   gebieden.dgdtw_topografie t1",
"      JOIN   gebieden.dgdtw_table_6023 s1 ON t1.id = s1.dgdtw_primary_key) q1 ON t.id = q1.id",
"      WHERE  t.objectcode = 6023 --bouwblok",
"      ORDER  BY s.code, q1.volgnummer"
    ]
  },
  "gob_mapping": {
    "identificatie": {
      "source_mapping": "identificatie"
    },
    "volgnummer": {
      "source_mapping": "volgnummer"
    },
    "registratiedatum": {
      "source_mapping": "registratiedatum",
      "format": "%Y-%m-%d %H:%M:%S"
    },
    "code": {
      "source_mapping": "code"
    },
    "datum_begin_geldigheid": {
      "source_mapping": "datum_begin_geldigheid"
    },
    "datum_einde_geldigheid": {
      "source_mapping": "datum_einde_geldigheid"
    },
    "ligt_in_buurt": {
      "source_mapping": {
        "bronwaarde": "ligt_in_buurt"
      }
    },
    "geometrie": {
      "source_mapping": "geometrie"
    }
  }
}
