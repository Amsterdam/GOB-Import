{
  "version": "0.1",
  "catalogue": "gebieden",
  "entity": "wijken",
  "source": {
    "name": "AMSBI",
    "application": "DGDialog",
    "entity_id": "source_id",
    "type": "database",
    "schema": "dgdialog",
    "depends_on": {
      "_application": "DIVA"
    },
    "inject": {
      "from": "data/wijken.conversion.json",
      "on": "code",
      "conversions": {
        "identificatie": "=",
        "volgnummer": "+"
      }
    },
    "query": [
"    SELECT s.naam                               AS naam",
"    ,      s.sdlcode || s.wijkcode              AS code",
"    ,      q1.volgnummer                        AS volgnummer",
"    ,      to_char(q1.ingsdatum, 'YYYY-MM-DD')  AS datum_begin_geldigheid",
"    ,      to_char(q1.einddatum, 'YYYY-MM-DD')  AS datum_einde_geldigheid",
"    ,      to_char(s.docdatum, 'YYYY-MM-DD')    AS documentdatum",
"    ,      s.docnr                              AS documentnummer",
"    ,      s.sdlcode                            AS ligt_in_stadsdeel",
"    ,      t.inwin                              AS registratiedatum",
"    ,      t.guid                               AS source_id",
"    ,      sdo_util.to_wktgeometry(t.geometrie) AS geometrie",
"      FROM   gebieden.dgdtw_topografie t",
"      JOIN   gebieden.dgdtw_table_6025 s ON t.id = s.dgdtw_primary_key",
"      JOIN  (SELECT t1.id",
"    ,      t1.guid",
"    ,      s1.ingsdatum",
"    ,      s1.einddatum",
"    ,      dense_rank() OVER (partition BY s1.sdlcode || s1.wijkcode ORDER BY t1.inwin) AS volgnummer",
"      FROM   gebieden.dgdtw_topografie t1",
"      JOIN   gebieden.dgdtw_table_6025 s1 ON t1.id = s1.dgdtw_primary_key) q1 ON t.id = q1.id",
"      WHERE  t.objectcode = 6025 -- wijk",
"      ORDER  BY q1.volgnummer"
    ]
  },
  "gob_mapping": {
    "identificatie": {
      "source_mapping": "identificatie"
    },
    "volgnummer": {
      "source_mapping": "volgnummer"
    },
    "registratiedatum": {
      "source_mapping": "registratiedatum",
      "format": "%Y-%m-%d %H:%M:%S"
    },
    "naam": {
      "source_mapping": "naam"
    },
    "code": {
      "source_mapping": "code"
    },
    "datum_begin_geldigheid": {
      "source_mapping": "datum_begin_geldigheid"
    },
    "datum_einde_geldigheid": {
      "source_mapping": "datum_einde_geldigheid"
    },
    "documentdatum": {
      "source_mapping": "documentdatum"
    },
    "documentnummer": {
      "source_mapping": "documentnummer"
    },
    "ligt_in_stadsdeel": {
      "source_mapping": {
        "bronwaarde": "ligt_in_stadsdeel"
      }
    },
    "cbs_code": {
      "source_mapping": "cbs_code"
    },
    "geometrie": {
      "source_mapping": "geometrie"
    }
  }
}
